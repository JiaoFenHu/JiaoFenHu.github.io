<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/alibaba_bdx.svg?v=6.3.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/alibaba_bdx.svg?v=6.3.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/alibaba_bdx.svg?v=6.3.0"><link rel="mask-icon" href="/images/alibaba_bdx.svg?v=6.3.0" color="#222"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"6.3.0",sidebar:{position:"left",display:"always",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="前言本篇文章将带您学习如何使用 ffmpeg 实现截取视频封面图保存到本地，以及在 Linux 安装ffmpeg 的过程。"><meta name="keywords" content="php,ffmpeg"><meta property="og:type" content="article"><meta property="og:title" content="PHP使用ffmpeg实现截取视频封面图"><meta property="og:url" content="https://jiaofenhu.github.io/posts/ffmpeg/4ef34b77.html"><meta property="og:site_name" content="愈望愈无望"><meta property="og:description" content="前言本篇文章将带您学习如何使用 ffmpeg 实现截取视频封面图保存到本地，以及在 Linux 安装ffmpeg 的过程。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://i.loli.net/2018/12/15/5c1478a7661db.png"><meta property="og:updated_time" content="2020-03-07T08:37:34.938Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="PHP使用ffmpeg实现截取视频封面图"><meta name="twitter:description" content="前言本篇文章将带您学习如何使用 ffmpeg 实现截取视频封面图保存到本地，以及在 Linux 安装ffmpeg 的过程。"><meta name="twitter:image" content="https://i.loli.net/2018/12/15/5c1478a7661db.png"><link rel="canonical" href="https://jiaofenhu.github.io/posts/ffmpeg/4ef34b77.html"><script type="text/javascript" id="page.configurations">CONFIG.page={sidebar:""}</script><title>PHP使用ffmpeg实现截取视频封面图 | 愈望愈无望</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?480232f3c7a2a5ab19556eebbac9fd18";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style type="text/css">.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/Harlan-zh" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">愈望愈无望</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Please Call Me Code Imp</p></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://jiaofenhu.github.io/posts/ffmpeg/4ef34b77.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="胡椒粉"><meta itemprop="description" content="愈望愈无望 - 个人博客"><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="愈望愈无望"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">PHP使用ffmpeg实现截取视频封面图</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-12-15 16:47:23" itemprop="dateCreated datePublished" datetime="2018-12-15T16:47:23+08:00">2018-12-15</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-03-07 16:37:34" itemprop="dateModified" datetime="2020-03-07T16:37:34+08:00">2020-03-07</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ffmpeg/" itemprop="url" rel="index"><span itemprop="name">ffmpeg</span></a></span></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <a href="/posts/ffmpeg/4ef34b77.html#comments" itemprop="discussionUrl"><span class="post-meta-item-text">评论数：</span><span class="post-comments-count valine-comment-count" data-xid="/posts/ffmpeg/4ef34b77.html" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p><img src="https://i.loli.net/2018/12/15/5c1478a7661db.png" alt="QQ图片20181215112806.png"></p><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>本篇文章将带您学习如何使用 <code>ffmpeg</code> 实现截取视频封面图保存到本地，以及在 <code>Linux</code> 安装<code>ffmpeg</code> 的过程。</p><a id="more"></a><h3 id="ffmpeg-介绍"><a href="#ffmpeg-介绍" class="headerlink" title="ffmpeg 介绍"></a>ffmpeg 介绍</h3><p><code>ffmpeg</code> 是一个很强大的音视频处理工具，<a href="http://ffmpeg.org/" target="_blank" rel="noopener">官网</a> 介绍<code>ffmpeg</code>是：一个完整的、跨平台的解决方案，可以记录、转换和传输音频和视频。<code>ffmpeg</code> 既可以播放视频，也提供命令行工具来处理视频，另外还有强大的视频处理库用于开发。</p><h3 id="Linux-安装-ffmpeg"><a href="#Linux-安装-ffmpeg" class="headerlink" title="Linux 安装 ffmpeg"></a>Linux 安装 ffmpeg</h3><h4 id="下载安装-ffmpeg"><a href="#下载安装-ffmpeg" class="headerlink" title="下载安装 ffmpeg"></a>下载安装 ffmpeg</h4><p>去 <a href="http://www.ffmpeg.org/" target="_blank" rel="noopener">ffmpeg 官网</a> 下载<code>4.0.3</code> 安装包。 下载之后上传至<code>Linux</code>准备安装，首先解压安装包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -xjvf ffmpeg-3.3.1.tar.bz2</span><br><span class="line">cd ffmpeg-3.3.1/</span><br><span class="line">./configure --enable-shared --prefix=/monchickey/ffmpeg</span><br></pre></td></tr></table></figure><div class="note warning"><p>注意：<br>如果现在直接执行<code>configure</code>配置的话，可能会报如下的错误：<br><code style="color:#c33e3f">yasm/nasm not found or too old. Use –disable-yasm for a crippled build.</code><br>错误的意思是 <code>yasm/nasm</code> 包不存在或者很旧，可以使用<code>--disable-yasm</code>禁用这个选项编译也可以按照下面的步骤进行安装<code>yasm</code>。</p></div><h4 id="下载安装-yasm"><a href="#下载安装-yasm" class="headerlink" title="下载安装 yasm"></a>下载安装 yasm</h4><ul><li><code>yasm</code>是一款汇编器，并且是完全重写了<code>nasm</code>的汇编环境，接收<code>nasm</code>和<code>gas</code>语法，支持<code>x86</code>和<code>amd64</code>指令集。</li><li>安装<code>yasm</code>：<a href="http://yasm.tortall.net/Download.html" target="_blank" rel="noopener">yasm 安装地址</a></li><li>下载完成后传到服务器上进行安装，下面是安装方法（这里我安装的是 <code>1.3.0</code>）</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -xvzf yasm-1.3.0.tar.gz</span><br><span class="line">cd yasm-1.3.0/</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><ul><li>编译参数都是默认的，直接安装到系统中即可。</li></ul><h4 id="继续安装-ffmpeg"><a href="#继续安装-ffmpeg" class="headerlink" title="继续安装 ffmpeg"></a>继续安装 ffmpeg</h4><p><code>yasm</code>安装成功之后继续回到<code>ffmpeg</code>解压后的目录，执行下面命令编译并安装：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure --enable-shared --prefix=/monchickey/ffmpeg</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p></p><p>这个编译的过程时间可能有点长，这时候我们可以去泡杯咖啡了。</p><p>安装完成之后进入到安装目录：<code>cd /monchickey/ffmpeg/</code>.<br></p><div class="note default"><p>├─ ffmpeg<br>├─── bin // ffmpeg主程序二进制目录<br>├─── include // C/C++头文件目录<br>├─── lib // 编译好的库文件目录<br>├─── share // 文档目录</p></div><br>进入<code>bin</code>目录，执行 <code>./ffmpeg -version</code> 查看当前版本的详细信息<p></p><p>默认情况下一般会报：<code style="color:#c33e3f">libavdevice.so.57: cannot open shared object file: No such file or directory</code></p><p>原因是<code>lib</code>目录未加载到链接到系统库中，系统<code>ld</code>目录列表在<code>/etc/ld.so.conf</code>中，打开文件会发现，里面引用了<code>/etc/ld.so.conf.d/</code>下面所有的<code>.conf</code>文。</p><p>这时我们只需要创建一个文件并写入<code>lib</code>路径即可，执行命令：<code>vim /etc/ld.so.conf.d/ffmpeg.conf</code> 然后添加一行内容：<code>/monchickey/ffmpeg/lib</code> 之后保存并退出，然后执行 <code>ldconfig</code> 使配置生效，现在再次执行 <code>./ffmpeg -version</code> 显示就正常了<br></p><div class="note success"><p>提示：可以根据需要将bin目录添加至环境变量中以保证任何时候都能使用<code>ffmpeg</code>命令</p></div><p></p><h3 id="使用php代码实现视频封面图截取"><a href="#使用php代码实现视频封面图截取" class="headerlink" title="使用php代码实现视频封面图截取"></a>使用php代码实现视频封面图截取</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传视频</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 视频路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_video</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($_FILES[<span class="string">"file"</span>][<span class="string">"error"</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        $api-&gt;dataerror(<span class="string">'视频上传错误!'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        </span><br><span class="line">        $type = [</span><br><span class="line">            <span class="string">"video/rmvb"</span>,</span><br><span class="line">            <span class="string">"video/wmv"</span>,</span><br><span class="line">            <span class="string">"video/3gp"</span>,</span><br><span class="line">            <span class="string">"video/mkv"</span>,</span><br><span class="line">            <span class="string">"video/mp4"</span>,</span><br><span class="line">            <span class="string">"video/mpg"</span>,</span><br><span class="line">            <span class="string">"video/avi"</span>,</span><br><span class="line">            <span class="string">"video/quicktime"</span>,</span><br><span class="line">            <span class="string">"multipart/video"</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">if</span> (in_array($_FILES[<span class="string">"file"</span>][<span class="string">"type"</span>], $type)) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>($_FILES[<span class="string">"file"</span>][<span class="string">"size"</span>] &lt;= <span class="number">20</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">                $upload_path = <span class="string">'uploads/video/file_name'</span>;	 <span class="comment">//建立文件夹</span></span><br><span class="line">                create($upload_path);</span><br><span class="line">                $file_name        = md5(uniqid(rand()));    <span class="comment">// 文件随机名字</span></span><br><span class="line">                $file_ext         = strtolower(substr($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>], strrpos($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>], <span class="string">"."</span>) + <span class="number">1</span>, strlen($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>])));    <span class="comment">// 获取文件后缀</span></span><br><span class="line"></span><br><span class="line">                $upload_path_file = $upload_path . $file_name . <span class="string">'.'</span> . $file_ext;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (file_exists($upload_path_file)) &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'视频文件名以被占用, 请重新上传!'</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>], $upload_path_file)) &#123;</span><br><span class="line"></span><br><span class="line">                        $video_path = $upload_path_file;	<span class="comment">// 视频路径</span></span><br><span class="line">                        $item[<span class="string">'video_path'</span>] = $video_path;</span><br><span class="line"></span><br><span class="line">                        $face_name = $upload_path . $file_name . <span class="string">'.'</span> . <span class="string">'png'</span>; <span class="comment">//视频封面图</span></span><br><span class="line">                        $pic_size = getVideoInfo($video_path);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> ($pic_size[<span class="string">'2'</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                             $str = <span class="string">"/monchickey/ffmpeg/bin/ffmpeg -i "</span> . $video_path . <span class="string">" -y -f mjpeg -ss 1 -t 0.001 -s "</span> . $pic_size[<span class="number">1</span>] . <span class="string">"x"</span> . $pic_size[<span class="number">0</span>] . <span class="string">" "</span> . $face_name;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                             $str = <span class="string">"/monchickey/ffmpeg/bin/ffmpeg -i "</span> . $video_path . <span class="string">" -y -f mjpeg -ss 1 -t 0.001 -s "</span> . $pic_size[<span class="number">0</span>] . <span class="string">"x"</span> . $pic_size[<span class="number">1</span>] . <span class="string">" "</span> . $face_name;</span><br><span class="line">                        &#125;</span><br><span class="line">                        system($str);</span><br><span class="line">                        <span class="keyword">if</span> (file_exists($face_name)) &#123;</span><br><span class="line">                            $item[<span class="string">'video_face_image'</span>] = $name;</span><br><span class="line">                        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">"视频封面图截取失败!"</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">return</span> $item;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    	<span class="keyword">echo</span> <span class="string">"视频文件上传失败!"</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"视频最大不能超过20M!"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        	<span class="keyword">echo</span> <span class="string">"视频格式错误!"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建文件夹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $dir 文件夹路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">($dir)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( !is_dir($dir) )&#123;</span><br><span class="line">        $temp = explode(<span class="string">'/'</span>,$dir);</span><br><span class="line">        $cur_dir = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; count($temp); $i++)&#123;</span><br><span class="line">            $cur_dir .= $temp[$i].<span class="string">'/'</span>;</span><br><span class="line">            <span class="keyword">if</span>(!is_dir($cur_dir))&#123;</span><br><span class="line">                @mkdir($cur_dir,<span class="number">0777</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理视频文件文件截取封面图的信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $file 视频文件路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getVideoInfo</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $command = sprintf(<span class="string">'/monchickey/ffmpeg/bin/ffmpeg -i "%s" 2&gt;&amp;1'</span>, $file);</span><br><span class="line"></span><br><span class="line">    ob_start();</span><br><span class="line"></span><br><span class="line">    passthru($command);</span><br><span class="line"></span><br><span class="line">    $info = ob_get_contents();</span><br><span class="line">    ob_end_clean();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/Video: (.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?)[,\s]/"</span>, $info, $match)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($match <span class="keyword">as</span> $k =&gt; $m) &#123;</span><br><span class="line">            <span class="keyword">if</span> (strstr($m, <span class="string">'x'</span>) &amp;&amp; $k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                $size1 = explode(<span class="string">'x'</span>, trim($m));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">"/^\d*$/"</span>, $size1[<span class="number">0</span>])) &#123;</span><br><span class="line">                    $size[<span class="number">0</span>] = $size1[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">if</span> (preg_match(<span class="string">"/^\d*$/"</span>, $size1[<span class="number">1</span>])) &#123;</span><br><span class="line">                        $size[<span class="number">1</span>] = $size1[<span class="number">1</span>];</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        $size2 = explode(<span class="string">' '</span>, trim($size1[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">                        $size[<span class="number">1</span>] = $size2[<span class="number">0</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/Side data:[,\s]/"</span>, $info, $match2)) &#123;</span><br><span class="line">        $size[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://www.cnblogs.com/freeweb/p/6897907.html" target="_blank" rel="noopener">博客园 - 自由的web</a></li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/php/" rel="tag"><i class="fa fa-tag"></i> php</a><a href="/tags/ffmpeg/" rel="tag"><i class="fa fa-tag"></i> ffmpeg</a></div><div class="post-widgets"><div class="social_share"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/xdebug/8d586dc9.html" rel="next" title="phpstorm配置Xdebug"><i class="fa fa-chevron-left"></i> phpstorm配置Xdebug</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/posts/git/113d1d94.html" rel="prev" title="git学习之路">git学习之路<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="胡椒粉"><p class="site-author-name" itemprop="name">胡椒粉</p><p class="site-description motion-element" itemprop="description">愈望愈无望 - 个人博客</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">10</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">8</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">11</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Harlan-zh" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:1204484685@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="http://wpa.qq.com/msgrd?v=3&uin=1204484685&site=qq&menu=yes" target="_blank" title="QQ"><i class="fa fa-fw fa-qq"></i> QQ</a></span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/ac94d3975aba" target="_blank" title="简书"><i class="fa fa-fw fa-heartbeat"></i> 简书</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 个人推荐</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://hooray.github.io/" title="hooray代码小睿博客" target="_blank">hooray代码小睿博客</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ffmpeg-介绍"><span class="nav-number">2.</span> <span class="nav-text">ffmpeg 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux-安装-ffmpeg"><span class="nav-number">3.</span> <span class="nav-text">Linux 安装 ffmpeg</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#下载安装-ffmpeg"><span class="nav-number">3.1.</span> <span class="nav-text">下载安装 ffmpeg</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#下载安装-yasm"><span class="nav-number">3.2.</span> <span class="nav-text">下载安装 yasm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#继续安装-ffmpeg"><span class="nav-number">3.3.</span> <span class="nav-text">继续安装 ffmpeg</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用php代码实现视频封面图截取"><span class="nav-number">4.</span> <span class="nav-text">使用php代码实现视频封面图截取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考"><span class="nav-number">5.</span> <span class="nav-text">参考</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2021</span><span class="with-love" id="animate"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">胡椒粉</span></div> <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("08/10/2018 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="Run for "+dnum+" Days ",document.getElementById("times").innerHTML=hnum+" Hours "+mnum+" m "+snum+" s"}setInterval("createtime()",250)</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/velocity-animate@1.2.1/velocity.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/velocity-animate@1.2.1/velocity.ui.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/Harlan-zh/harlan-zh.github.io@1/js/src/utils.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/Harlan-zh/harlan-zh.github.io@1/js/src/motion.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/Harlan-zh/harlan-zh.github.io@1/js/src/affix.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/Harlan-zh/harlan-zh.github.io@1/js/src/schemes/pisces.js"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script><script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/Harlan-zh/harlan-zh.github.io@1/js/src/bootstrap.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">var GUEST=["nick","mail","link"],guest="nick,mail,link",required="nick,mail";guest=guest.split(",").filter(function(e){return-1<GUEST.indexOf(e)}),required=required.split(",").filter(function(e){return-1<GUEST.indexOf(e)}),new Valine({el:"#comments",verify:!1,notify:!1,appId:"25anTYm1rWnTjes3GDW5SS5I-gzGzoHsz",appKey:"hKEQR25tkz1Fgg6T1Uve8lEv",placeholder:"下面，开始你的节奏!",avatar:"mm",meta:guest,pageSize:"10",visitor:!1,emojiCDN:"//",emojiMaps:{"zdy_傲娇":"cdn.jsdelivr.net/gh/drew233/cdn/20200409103906.webp","zdy_开心":"cdn.jsdelivr.net/gh/drew233/cdn/20200409104757.webp","zdy_扣扣手":"cdn.jsdelivr.net/gh/drew233/cdn/20200409130304.webp","zdy_仙女下凡":"cdn.jsdelivr.net/gh/drew233/cdn/20200409130301.webp",zdy_dese:"cdn.jsdelivr.net/gh/drew233/cdn/20200409130258.webp","zdy_左揉脸":"cdn.jsdelivr.net/gh/drew233/cdn/20200409130254.webp","zdy_右揉脸":"cdn.jsdelivr.net/gh/drew233/cdn/20200409130249.webp","zdy_滑稽":"cdn.jsdelivr.net/gh/moezx/cdn@3.1.9/img/Sakura/images/smilies/icon_huaji.gif","zdy_喵喵":"img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7b/2018new_miaomiao_thumb.png","zdy_汪汪":"img.t.sinajs.cn/t4/appstyle/expression/ext/normal/22/2018new_erha_org.png","tv_白眼":"i0.hdslb.com/bfs/emote/c1d59f439e379ee50eef488bcb5e5378e5044ea4.png",tv_doge:"i0.hdslb.com/bfs/emote/6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_坏笑":"i0.hdslb.com/bfs/emote/1f0b87f731a671079842116e0991c91c2c88645a.png","tv_难过":"i0.hdslb.com/bfs/emote/87f46748d3f142ebc6586ff58860d0e2fc8263ba.png","tv_生气":"i0.hdslb.com/bfs/emote/26702dcafdab5e8225b43ffd23c94ac1ff932654.png","tv_委屈":"i0.hdslb.com/bfs/emote/d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_斜眼笑":"i0.hdslb.com/bfs/emote/911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png","tv_呆":"i0.hdslb.com/bfs/emote/fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_发怒":"i0.hdslb.com/bfs/emote/34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_惊吓":"i0.hdslb.com/bfs/emote/0d15c7e2ee58e935adc6a7193ee042388adc22af.png","tv_呕吐":"i0.hdslb.com/bfs/emote/9f996894a39e282ccf5e66856af49483f81870f3.png","tv_思考":"i0.hdslb.com/bfs/emote/90cf159733e558137ed20aa04d09964436f618a1.png","tv_微笑":"i0.hdslb.com/bfs/emote/70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_疑问":"i0.hdslb.com/bfs/emote/0793d949b18d7be716078349c202c15ff166f314.png","tv_大哭":"i0.hdslb.com/bfs/emote/23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_鼓掌":"i0.hdslb.com/bfs/emote/1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png","tv_抠鼻":"i0.hdslb.com/bfs/emote/c666f55e88d471e51bbd9fab9bb308110824a6eb.png","tv_亲亲":"i0.hdslb.com/bfs/emote/a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_调皮":"i0.hdslb.com/bfs/emote/b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png","tv_笑哭":"i0.hdslb.com/bfs/emote/1abc628f6d4f4caf9d0e7800878f4697abbc8273.png","tv_晕":"i0.hdslb.com/bfs/emote/5443c22b4d07fb1907ccc610c8e6db254f2461b7.png","tv_点赞":"i0.hdslb.com/bfs/emote/f85c354995bd99e28fc76c869bfe42ba6438eff4.png","tv_害羞":"i0.hdslb.com/bfs/emote/a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_睡着":"i0.hdslb.com/bfs/emote/8b196675b53af58264f383c50ad0945048290b33.png","tv_色":"i0.hdslb.com/bfs/emote/61822c7e9aae5da76475e7892534545336b23a6f.png","tv_吐血":"i0.hdslb.com/bfs/emote/09dd16a7aa59b77baa1155d47484409624470c77.png","tv_无奈":"i0.hdslb.com/bfs/emote/ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png","tv_再见":"i0.hdslb.com/bfs/emote/180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_流汗":"i0.hdslb.com/bfs/emote/cead1c351ab8d79e9f369605beb90148db0fbed3.png","tv_偷笑":"i0.hdslb.com/bfs/emote/bb690d4107620f1c15cff29509db529a73aee261.png","tv_抓狂":"i0.hdslb.com/bfs/emote/fe31c08edad661d63762b04e17b8d5ae3c71a757.png","tv_黑人问号":"i0.hdslb.com/bfs/emote/45821a01f51bc867da9edbaa2e070410819a95b2.png","tv_困":"i0.hdslb.com/bfs/emote/241ee304e44c0af029adceb294399391e4737ef2.png","tv_打脸":"i0.hdslb.com/bfs/emote/56ab10b624063e966bfcb76ea5dc4794d87dfd47.png","tv_闭嘴":"i0.hdslb.com/bfs/emote/c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png","tv_鄙视":"i0.hdslb.com/bfs/emote/6e72339f346a692a495b123174b49e4e8e781303.png","tv_腼腆":"i0.hdslb.com/bfs/emote/89712c0d4af73e67f89e35cbc518420380a7f6f4.png","tv_馋":"i0.hdslb.com/bfs/emote/fc7e829b845c43c623c8b490ee3602b7f0e76a31.png","tv_可爱":"i0.hdslb.com/bfs/emote/9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_发财":"i0.hdslb.com/bfs/emote/34db290afd2963723c6eb3c4560667db7253a21a.png","tv_生病":"i0.hdslb.com/bfs/emote/8b0ec90e6b86771092a498c54f09fc94621c1900.png","tv_流鼻血":"i0.hdslb.com/bfs/emote/c32d39db2737f89b904ca32700d140a9241b0767.png","tv_尴尬":"i0.hdslb.com/bfs/emote/7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_大佬":"i0.hdslb.com/bfs/emote/093c1e2c490161aca397afc45573c877cdead616.png","tv_流泪":"i0.hdslb.com/bfs/emote/7e71cde7858f0cd50d74b0264aa26db612a8a167.png","tv_冷漠":"i0.hdslb.com/bfs/emote/b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_皱眉":"i0.hdslb.com/bfs/emote/72ccad6679fea0d14cce648b4d818e09b8ffea2d.png","tv_鬼脸":"i0.hdslb.com/bfs/emote/0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png","tv_调侃":"i0.hdslb.com/bfs/emote/4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png","tv_目瞪口呆":"i0.hdslb.com/bfs/emote/0b8cb81a68de5d5365212c99375e7ace3e7891b7.png"},enableQQ:!0,requiredFields:required})</script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"middleRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script></body><script type="text/javascript" src="//cdn.jsdelivr.net/gh/Harlan-zh/harlan-zh.github.io@1/js/src/fireinput.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/Harlan-zh/harlan-zh.github.io@1/js/src/titleSettings.js"></script></html>